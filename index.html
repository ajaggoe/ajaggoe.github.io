<h1 id="error"></h1>
<h1 id="shake-count">0</h1>
<h1 id="acc-info"></h1>
<h1 id="light"></h1>

<script>
	function displayError(msg) {
		document.getElementById("error").innerHTML += msg + "<br>";
	}

	let shakeCnt = 0

	function onShake(accelerometer) {
		if (Math.abs(accelerometer.x) < 0.7) return;
	
		document.getElementById("shake-count").innerHTML = (++shakeCnt);
		document.getElementById("acc-info").innerHTML = `x: ${accelerometer.x}<br>
		y: ${accelerometer.x}<br>
		z: ${accelerometer.z}`;
	}
	
	function onLightRead(ambientLightSensor) {
		document.getElementById("light").innerHTML = `lux: $(ambientLightSensor.illuminance}`
	}

	let accelerometer = null;
	try {
		accelerometer = new Accelerometer({ referenceFrame: 'device' });
		accelerometer.addEventListener('error', event => {
			// Handle runtime errors.
			if (event.error.name === 'NotAllowedError') {
				// Branch to code for requesting permission.
			} else if (event.error.name === 'NotReadableError' ) {
				displayError('Cannot connect to the sensor.');
			}
		});
		accelerometer.addEventListener('reading', () => onShake(accelerometer));
		accelerometer.start();
	} catch (error) {
		// Handle construction errors.
		if (error.name === 'SecurityError') {
			// See the note above about feature policy.
			displayError('Sensor construction was blocked by a feature policy.');
		} else if (error.name === 'ReferenceError') {
			displayError('Sensor is not supported by the User Agent.');
		} else {
			throw error;
		}
	}
	
	let ambientLightSensor = null;
	try {
		ambientLightSensor = new AmbientLightSensor({frequency: 60});
		ambientLightSensor.addEventListener('error', event => {
			// Handle runtime errors.
			if (event.error.name === 'NotAllowedError') {
				// Branch to code for requesting permission.
			} else if (event.error.name === 'NotReadableError' ) {
				displayError('Cannot connect to the sensor.');
			}
		});
		ambientLightSensor.addEventListener('reading', () => onLightRead(ambientLightSensor));
		ambientLightSensor.start();
	} catch (error) {
		// Handle construction errors.
		if (error.name === 'SecurityError') {
			// See the note above about feature policy.
			displayError('Sensor construction was blocked by a feature policy.');
		} else if (error.name === 'ReferenceError') {
			displayError('Sensor is not supported by the User Agent.');
		} else {
			throw error;
		}
	}
</script>